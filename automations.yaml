####################################################################################
#                                                                                  #
#                                                                                  #
#                                AUTOMATIONS                                       #
#                                                                                  #
#                                                                                  #
####################################################################################

- alias: 'Allumer les lumières au couché du soleil'
  initial_state: 'on'
  trigger:
    platform: sun
    event: sunset
    offset: -01:30:00
  condition:
    condition: or
    conditions:
      #Tracking OWNTRACK
      - condition: state
        entity_id: device_tracker.jungle_owntrack3t
        state: 'home'
      #Tracking DD-WRT
      - condition: state
        entity_id: device_tracker.androidf1562bd8cb4c4a91
        state: 'home'
  action:
    service: homeassistant.turn_on
    entity_id: light.salon

- alias: 'Allumer les lumières @ arrivée Home'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: device_tracker.androidf1562bd8cb4c4a91
    to: 'home'
  condition:
    condition: numeric_state
    entity_id: sensor.lumsens_1
    below: '300'
  action:
    service: homeassistant.turn_on
    entity_id: light.salon, light.cuisine
    
- alias: 'Allumer PC @ arrivée Home'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: device_tracker.androidf1562bd8cb4c4a91
    to: 'home'
  action:
    service: homeassistant.turn_on
    entity_id: switch.junglepc

- alias: 'Allumer chauffage @ arrivée Home'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: device_tracker.androidf1562bd8cb4c4a91
    to: 'home'
    # AJOUTER UN TRIGGER SI LAST MOTION ENTREE MOINS DE 2 MINUTE
  action:
    service: climate.set_temperature
    data:
        entity_id: climate.salon
        temperature: '22'

- alias: 'Eteindre musique au depart'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: device_tracker.androidf1562bd8cb4c4a91
    to: 'not_home'
  condition:
    condition: state
    entity_id: media_player.denon_chambre
    state: 'on'
  action:
    service: homeassistant.turn_off
    entity_id: media_player.denon_chambre

- alias: 'Eteindre lumiere au depart'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: device_tracker.androidf1562bd8cb4c4a91
    to: 'not_home'
    # AJOUTER UN TRIGGER SI LAST MOTION ENTREE MOINS DE 2 MINUTE
  action:
    service: homeassistant.turn_off
    entity_id: light.salon, light.cuisine, light.vestibule
    
- alias: 'Eteindre chauffage au depart'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: device_tracker.androidf1562bd8cb4c4a91
    to: 'not_home'
    # AJOUTER UN TRIGGER SI LAST MOTION ENTREE MOINS DE 2 MINUTE
  action:
    - service: climate.set_temperature
      data:
        entity_id: climate.salon
        temperature: '17'
    - service : homeassistant.turn_off
      data:
        entity_id: switch.radiateur_salon

- alias: 'Eteindre PC au depart'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: device_tracker.androidf1562bd8cb4c4a91
    to: 'not_home'
  condition:
    condition: state
    entity_id: switch.jungle_pc
    state: 'on'
  action:
    service: homeassistant.turn_off
    entity_id: switch.jungle_pc

####################################################################################
#                                                                                  #
#                                                                                  #
#                                PLEX & CAST                                       #
#                                                                                  #
#                                                                                  #
####################################################################################

- alias: Si CAST PLEX Alors Light 10
  trigger:
    platform: state
    entity_id: sensor.rasplex
    to: playing
  condition:
  - condition: state
    entity_id: sensor.chromecast_source
    state: 'Plex'
  action:
    service: scene.turn_on
    entity_id: scene.plexon

- alias: Si PAUSE PLEX Alors Light 70
  trigger:
    platform: state
    entity_id: sensor.rasplex
    to: paused
  condition:
  - condition: state
    entity_id: sensor.chromecast_source
    state: 'Plex'
  action:
    service: scene.turn_on
    entity_id: scene.plexpause

- alias: Si FIN PLEX Alors Light 100
  initial_state: 'off'
  trigger:
    platform: state
    entity_id: sensor.rasplex
    to: idle
    for:
      hours: 00
      minutes: 00
      seconds: 03
  action:
    service: scene.turn_on
    entity_id: scene.plexoff

####################################################################################
#                                                                                  #
#                                                                                  #
#                                SENSOR > LIGHTS                                   #
#                                                                                  #
#                                                                                  #
####################################################################################
  
- alias: 'Allumer la LED 1 si mouvement'
  action:
  - data:
      entity_id: light.led_1
    service: light.turn_on
  condition:
  - condition: state
    entity_id: light.led_1
    state: 'off'
  trigger:
  - entity_id: sensor.motion_1
    from: standby
    platform: state
    to: motion detected

- alias: 'Eteindre la LED 1 si mouvement'
  action:
  - data:
      entity_id: light.led_1
    service: light.turn_off
  condition:
  - condition: state
    entity_id: light.led_1
    state: 'on'
  trigger:
  - entity_id: sensor.motion_1
    from: motion detected
    platform: state
    to: standby

- alias: 'Allumer la LED 2 si mouvement'
  action:
  - data:
      entity_id: light.led_2
    service: light.turn_on
  condition:
  - condition: state
    entity_id: light.led_2
    state: 'off'
  trigger:
  - entity_id: sensor.motion_2
    from: standby
    platform: state
    to: motion detected

- alias: 'Eteindre la LED 2 si mouvement'
  action:
  - data:
      entity_id: light.led_2
    service: light.turn_off
  condition:
  - condition: state
    entity_id: light.led_2
    state: 'on'
  trigger:
  - entity_id: sensor.motion_2
    from: motion detected
    platform: state
    to: standby

- alias: 'Allumer la cuisine si mouvement'
  action:
    data:
      entity_id:
      - light.cuisine
    service: homeassistant.turn_on
  condition:
  - condition: state
    entity_id: light.cuisine
    state: 'off'
  - condition: numeric_state
    below: '300'
    entity_id: sensor.lumsens_1
  trigger:
  - entity_id: sensor.motion_1
    from: standby
    platform: state
    to: motion detected

- alias: 'Allumer la chambre si mouvement'
  action:
    data:
      entity_id:
      - light.vestibule
    service: homeassistant.turn_on
  condition:
  - condition: state
    entity_id: light.vestibule
    state: 'off'
  trigger:
  - entity_id: sensor.motion_2
    from: standby
    platform: state
    to: motion detected

- alias: 'Eteindre la lumière chambre après 10min'
  trigger:
    platform: state
    entity_id: sensor.motion_2
    to: 'standby'
    for:
      seconds: 30
  action:
    service: homeassistant.turn_off
    entity_id: light.vestibule

- alias: 'Eteindre la lumière cuisine après 10min'
  trigger:
    platform: state
    entity_id: sensor.motion_1
    to: 'standby'
    for:
      minutes: 10
  action:
    service: homeassistant.turn_off
    entity_id: light.cuisine

- alias: 'Allumer le salon si luminosité basse'
  action:
    entity_id: light.salon
    service: homeassistant.turn_on
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: light.salon
        state: 'off'
      - condition: or
        conditions:
         #Tracking OWNTRACK
          - condition: state
            entity_id: device_tracker.jungle_owntrack3t
            state: 'home'
          #Tracking DD-WRT
          - condition: state
            entity_id: device_tracker.androidf1562bd8cb4c4a91
            state: 'home'
  trigger:
  - platform: numeric_state
    below: '300'
    entity_id: sensor.lumsens_1

- alias: 'Eteindre le salon si luminosité haute'
  action:
    entity_id: light.salon
    service: homeassistant.turn_off
  condition:
      condition: or
      conditions:
        #Tracking OWNTRACK
        - condition: state
          entity_id: device_tracker.jungle_owntrack3t
          state: 'home'
        #Tracking DD-WRT
        - condition: state
          entity_id: device_tracker.androidf1562bd8cb4c4a91
          state: 'home'
  trigger:
  - platform: numeric_state
    above: '300'
    entity_id: sensor.lumsens_1
  initial_state: 'off'

- alias: Salon Light - Adjust Brightness
  trigger:
    platform: state
    entity_id: input_slider.salon_brightness
  action:
    - service: light.turn_on
# Note the use of 'data_template:' below rather than the normal 'data:' if you weren't using an input variable
      data_template:
        entity_id: light.salon
        brightness: '{{ trigger.to_state.state | int }}'

- alias: Cuisine Light - Adjust Brightness
  trigger:
    platform: state
    entity_id: input_slider.cuisine_brightness
  action:
    - service: light.turn_on
# Note the use of 'data_template:' below rather than the normal 'data:' if you weren't using an input variable
      data_template:
        entity_id: light.cuisine
        brightness: '{{ trigger.to_state.state | int }}'

- alias: Vestibule Light - Adjust Brightness
  trigger:
    platform: state
    entity_id: input_slider.vestibule_brightness
  action:
    - service: light.turn_on
# Note the use of 'data_template:' below rather than the normal 'data:' if you weren't using an input variable
      data_template:
        entity_id: light.vestibule
        brightness: '{{ trigger.to_state.state | int }}'

- alias: 'Alerte pushbullet si 5° dehors'
  trigger:
    platform: numeric_state
    entity_id: sensor.yr_temperature
    below: '5'
  action:
    service: notify.pushbullet_3t
    data:
      title: 'Alerte GEL'
      message: 'Rentres les plantes, il va geler'

####################################################################################
#                                                                                  #
#                                                                                  #
#                                PC CONTROL                                        #
#                                                                                  #
#                                                                                  #
####################################################################################

- alias: junglepc_redemarrer
  trigger:
    platform: state
    entity_id: input_select.pcoptions
    to: "Redémarrer"
  action:
    - service: shell_command.restart_z800
    - service: input_select.select_option
      entity_id: input_select.pcoptions
      data_template:
        option: "Choisir une action"
- alias: junglepc_eteindre
  trigger:
    platform: state
    entity_id: input_select.pcoptions
    to: "Eteindre"
  action:
    - service: shell_command.shutdown_z800
    - service: input_select.select_option
      entity_id: input_select.pcoptions
      data_template:
        option: "Choisir une action"
- alias: junglepc_veille
  trigger:
    platform: state
    entity_id: input_select.pcoptions
    to: "Veille"
  action:
    - service: shell_command.sleep_z800
    - service: input_select.select_option
      entity_id: input_select.pcoptions
      data_template:
        option: "Choisir une action"

####################################################################################
#                                                                                  #
#                                                                                  #
#                                HARMONY HUB                                       #
#                                                                                  #
#                                                                                  #
####################################################################################

- alias: Harmony
  hide_entity: True
  trigger:
    platform: state
    entity_id: input_select.harmony
    from: 'Choisir la source'
  action:
    - service: remote.turn_on
      entity_id: remote.hub_salon
      data_template:
        activity: >
          {% if is_state("input_select.harmony", "Chromecast") %}
            27262320
          {% elif is_state("input_select.harmony", "Chambre Bluetooth") %}
            28429925
          {% elif is_state("input_select.harmony", "Vinyle") %}
            28532020
          {% else %}
          {% endif %}
    - service: input_select.select_option
      entity_id: input_select.harmony
      data_template:
        option: "Choisir la source"

- alias: Harmony Off
  hide_entity: True
  trigger:
    platform: state
    entity_id: input_select.harmony
    to: 'Arrêt'
  action:
    - service: remote.turn_off
      entity_id: remote.hub_salon
    - service: input_select.select_option
      entity_id: input_select.harmony
      data_template:
        option: "Choisir la source"